<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Validated pattern structure | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class=pf-c-nav__item><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/contribute-to-docs/ class=pf-c-nav__link>Contributor's guide</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/background-on-pattern-development/ class=pf-c-nav__link>Background on pattern development</a><section class=pf-c-nav__subnav><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/structure/ class="pf-c-nav__link pf-m-current">Validated pattern structure</a></li></ul></section></li><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/extending-a-pattern/ class=pf-c-nav__link>Extending an existing pattern</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=/contribute/creating-a-pattern/ class=pf-c-nav__link>Creating a pattern</a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class="pf-c-page__main-section pf-m-fill"><div class=pf-u-display-flex><div class="pf-c-content min-height"><h1 id=validated-pattern-structure>Validated pattern structure</h1><h2 id=framework-fundamentals>Framework fundamentals</h2><p>The validated patterns framework uses <a href=https://docs.openshift.com/container-platform/4.9/cicd/gitops/understanding-openshift-gitops.html>OpenShift GitOps</a> (ArgoCD) as the primary driver for deploying patterns and keeping them up to date. Validated patterns use Helm charts as the primary artifacts for GitOps. <a href=https://helm.sh/>Helm charts</a> provide a mechanism for templating that is powerful when building repeatable, automated deployments across different deployment environments (i.e. clouds, data-centers, edge, etc.)</p><p>Many Cloud Native Computing Foundation (CNCF) projects use <a href=https://operatorframework.io/>Operators</a> to manage the lifecycle of their service. Whenever possible, validated patterns will make use of these Operators to deploy the application service.</p><p><a href=https://www.redhat.com/en/technologies/management/advanced-cluster-management>Red Hat Advanced Cluster Management</a> (ACM) is primarily used to automate the deployment of edge clusters. It provides subscription information for specific deployment sites.</p><p><a href=https://docs.openshift.com/container-platform/4.9/cicd/pipelines/understanding-openshift-pipelines.html>OpenShift Pipelines</a> is used to automate builds and keep image repositories up to date.</p><h2 id=pattern-directories-tour>Pattern directories tour</h2><p>Examining any of the existing patterns reveals the important organizational part of the validated patterns framework. Let&rsquo;s take a look at a couple of the existing validated patterns: Multicluster GitOps and Industrial Edge.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>~/g/multicloud-gitops on main ◦ tree -L 2
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── charts
</span></span><span style=display:flex><span>│   └── region
</span></span><span style=display:flex><span>├── common
</span></span><span style=display:flex><span>│   ├── acm
</span></span><span style=display:flex><span>│   ├── clustergroup
</span></span><span style=display:flex><span>│   ├── common -&gt; .
</span></span><span style=display:flex><span>│   ├── examples
</span></span><span style=display:flex><span>│   ├── install
</span></span><span style=display:flex><span>│   ├── Makefile
</span></span><span style=display:flex><span>│   ├── Makefile.toplevel
</span></span><span style=display:flex><span>│   ├── pattern-vault.init
</span></span><span style=display:flex><span>│   ├── reference-output.yaml
</span></span><span style=display:flex><span>│   ├── scripts
</span></span><span style=display:flex><span>│   ├── tests
</span></span><span style=display:flex><span>│   └── values-global.yaml
</span></span><span style=display:flex><span>├── Makefile
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>├── scripts
</span></span><span style=display:flex><span>│   └── make_common_subtree.sh
</span></span><span style=display:flex><span>├── values-global.yaml
</span></span><span style=display:flex><span>├── values-hub.yaml
</span></span><span style=display:flex><span>└── values-region-one.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>11 directories, 11 files
</span></span></code></pre></div><p>First we notice some subdirectories: charts, common, and scripts - along with <code>values-</code> yaml files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>~/g/industrial-edge on stable-2.0 ◦ tree -L 2
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── charts
</span></span><span style=display:flex><span>│   ├── datacenter
</span></span><span style=display:flex><span>│   └── factory
</span></span><span style=display:flex><span>├── common
</span></span><span style=display:flex><span>│   ├── acm
</span></span><span style=display:flex><span>│   ├── common -&gt; .
</span></span><span style=display:flex><span>│   ├── examples
</span></span><span style=display:flex><span>│   ├── install
</span></span><span style=display:flex><span>│   ├── Makefile
</span></span><span style=display:flex><span>│   ├── Makefile.toplevel
</span></span><span style=display:flex><span>│   ├── scripts
</span></span><span style=display:flex><span>│   ├── site
</span></span><span style=display:flex><span>│   ├── values-datacenter.yaml
</span></span><span style=display:flex><span>│   └── values-global.yaml
</span></span><span style=display:flex><span>├── docs
</span></span><span style=display:flex><span>│   ├── images
</span></span><span style=display:flex><span>│   └── old-deployment-map.txt
</span></span><span style=display:flex><span>├── images
</span></span><span style=display:flex><span>│   ├── import-cluster.png
</span></span><span style=display:flex><span>│   ├── import-with-kubeconfig.png
</span></span><span style=display:flex><span>│   └── launch-acm-console.png
</span></span><span style=display:flex><span>├── Makefile
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>├── scripts
</span></span><span style=display:flex><span>│   └── sleep-seed.sh
</span></span><span style=display:flex><span>├── SUPPORT_AGREEMENT.md
</span></span><span style=display:flex><span>├── values-datacenter.yaml
</span></span><span style=display:flex><span>├── values-factory.yaml
</span></span><span style=display:flex><span>├── values-global.yaml
</span></span><span style=display:flex><span>└── values-secret.yaml.template
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>14 directories, 16 files
</span></span></code></pre></div><p>We see the same or similar files in the Industrial Edge pattern above.</p><h2 id=the-charts-directory>The <code>charts</code> directory</h2><p>This is where validated patterns keep the helm charts for a pattern. The helm charts are used deploy and manage the various components of the applications deployed at a site. By convention, the charts are broken out by site location. You may see <code>datacenter</code>, <code>hub</code>, <code>factory</code>, or other site names in there.</p><p>Each site has sub-directories based on application or library component groupings.</p><p>From <a href=https://helm.sh/docs/chart_template_guide/getting_started/>Helm documentation:</a>
<em>Application charts</em> are a collection of templates that can be packaged into versioned archives to be deployed.</p><p><em>Library charts</em> provide useful utilities or functions for the chart developer. They&rsquo;re included as a dependency of application charts to inject those utilities and functions into the rendering
pipeline. Library charts do not define any templates and therefore cannot be deployed.</p><p>These groupings are used by OpenShift GitOps to deploy into the cluster. The configurations for each of the components inside an application are synced every three minutes by OpenShift GitOps to make sure that the site is up to date. The configuration can also be synced manually if you do not wish to wait up to three minutes.</p><p><a href=/images/framework/dir-ie-charts.png><img src=/images/framework/dir-ie-charts.png alt="Charts Dir"></a></p><p>The configuration YAML for each component of the application is stored in the templates sub-directory. For example, the Industrial Edge <code>datacenter</code> has a application called Kafka. The configuration for Kafka is stored in <code>kafka/templates</code>.</p><p><a href=/images/framework/dir-ie-kafka-charts.png><img src=/images/framework/dir-ie-kafka-charts.png alt="Charts Dir"></a></p><h2 id=the-common-directory>The <code>common</code> directory</h2><p>There are several common components that are in use across the validated patterns that exist today. E.g. the External Secrets operator and RHACM (Red Hat Advanced Cluster Management). These components are part of the validated patterns framework. They are configured to work together in the GitOps based framework. Rather than duplicating the configuration in each pattern, these common technologies are moved into a common directory. If there are pattern specific post-deployment configurations to be applied, those should be added to the Helm charts in the <code>charts</code> directory structure. This is unlikely for these components. Consider <code>common</code> out of bounds unless you are working on modifying the framework.</p><h2 id=the-scripts-directory>The <code>scripts</code> directory</h2><p>Sometimes an Operator and/or the Helm charts still leave some work to be done with regard to final configuration. When extra code is needed to deploy, the extra code is placed in the <code>scripts</code> directory. The majority of the time a consumer of a validated pattern will only use this code through the existing automation. I.e. The <code>Makefile</code> or OpenShift GitOps will make use of these scripts. So - If there is extra <em>massaging</em> required for your application, put the scripts in here and try to run them from within the automation. It is very unlikely you will need to change the scripts directory. Consider <code>scripts</code> out of bounds unless you are modifying the framework.</p><h2 id=applications-and-values--files>Applications and <code>values-</code> files</h2><p>Helm uses <code>values.yaml</code> files to pass variables into charts. Variables in the <code>values.yaml</code> file can be overridden in the following ways:</p><ol><li>By a <code>values.yaml</code> file in the parent directory</li><li>By a values file passed into the <code>helm &lt;install/upgrade></code> command using <code>-f</code></li><li>By specifying an override individual value in the the <code>helm</code> command with <code>--set</code></li></ol><p>For more information on values files and their usage see the <a href=https://helm.sh/docs/chart_template_guide/values_files/>values files section</a> of the Helm documentation.</p><p>This section is meant as an introduction to the <code>values-</code> files that the framework uses to override values in the chart templates. In the Getting Started pages there will be more specific usage details.</p><h3 id=there-are-three-types-of-value--files>There are three types of <code>value-</code> files.</h3><ol><li><strong><code>values-global.yaml</code></strong>:
This is used to set variables for helm charts across the pattern. It contains the name of the pattern and sets some other variables for artifacts like, image registry, Git repositories, GitOps syncPolicy etc.</li><li><strong><code>values-&lt;site>.yaml</code></strong>:
Each specific site requires information regarding what applications and subscriptions are required for that site. This file contains a list of namespaces, applications, subscriptions, the operator versions etc. for that site.</li><li><strong><code>values-secret.yaml.template</code></strong>:
All patterns require some secrets for artifacts included in the pattern. E.g. credentials for GitHub, AWS, or Quay.io. The framework provides a safe way to load those secrets into a vault for consumption by the pattern. This template file can be copied to your home directory, the secret values applied, and the validated pattern will go look for <code>values-secrets.yaml</code> in your home directory. <strong>Do not leave a <code>values-secrets.yaml</code> file in your cloned git directory or it may end up in your (often public) Git repository, like GitHub.</strong></li></ol><h3 id=values-files-can-have-some-overrides>Values files can have some overrides.</h3><ol><li><p>Version overrides can be used to set specific values for OCP versions. E.g. <strong><code>values-hub-4.12.yaml</code></strong> allows you to tweak a specific value for OCP 4.12 on the Hub cluster.</p></li><li><p>Version overrides can be used to set specific values for specific cloud providers. E.g. <strong><code>values-AWS.yaml</code></strong> would allow you to tweak a specific value for all cluster groups deployed on AWS.</p></li></ol><h3 id=other-combination-examples-include>Other combination examples include:</h3><ol><li><p><strong><code>values-hub-Azure.yaml</code></strong> only apply this Azure tweak on the hub cluster.</p></li><li><p><strong><code>values-4.12.yaml</code></strong> apply these OCP 4.12 tweaks to all cluster groups in this pattern.</p></li></ol><p>Current supported cloud providers include <strong><code>AWS</code></strong>, <strong><code>Azure</code></strong>, and <strong><code>GCP</code></strong>.</p><h2 id=applications--subscriptions>Applications & subscriptions</h2><h2 id=environment-values-and-helm>Environment values and Helm</h2><p>The reason the above values files exist is to take advantage of Helms ability to use templates and substitute values into your charts. This makes the pattern very portable.</p><p>The following <code>messaging-route.yaml</code> example shows how the AMQ messaging service is using values set in the <code>values-global.yaml</code> file for Industrial Edge.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>route.openshift.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Route</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>messaging</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>messaging</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>messaging-manuela-tst-all.apps.{{ .Values.global.datacenter.clustername }}.{{ .Values.global.datacenter.domain }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>3000</span>-<span style=color:#ae81ff>tcp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>to</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>messaging</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>weight</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>wildcardPolicy</span>: <span style=color:#ae81ff>None</span>
</span></span></code></pre></div><p>The values in the <code>values-global.yaml</code> will be substituted when the YAML is applied to the cluster.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pattern</span>: <span style=color:#ae81ff>industrial-edge</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>datacenter</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>clustername</span>: <span style=color:#ae81ff>ipbabble-dc</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>blueprints.rhecoeng.com</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>edge</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>clustername</span>: <span style=color:#ae81ff>ipbabble-f1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>blueprints.rhecoeng.com</span>
</span></span></code></pre></div></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#validated-pattern-structure>Validated pattern structure</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#framework-fundamentals>Framework fundamentals</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#pattern-directories-tour>Pattern directories tour</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#the-charts-directory>The <code>charts</code> directory</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#the-common-directory>The <code>common</code> directory</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#the-scripts-directory>The <code>scripts</code> directory</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#applications-and-values--files>Applications and <code>values-</code> files</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#there-are-three-types-of-value--files>There are three types of <code>value-</code> files.</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#values-files-can-have-some-overrides>Values files can have some overrides.</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#other-combination-examples-include>Other combination examples include:</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#applications--subscriptions>Applications & subscriptions</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#environment-values-and-helm>Environment values and Helm</a></li></ul></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>