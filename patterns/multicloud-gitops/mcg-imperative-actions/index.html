<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Imperative actions | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/ class=pf-c-nav__link>Multicloud GitOps</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-getting-started/ class=pf-c-nav__link>Getting started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-managed-cluster/ class=pf-c-nav__link>Managed cluster sites</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-cluster-sizing/ class=pf-c-nav__link>Cluster sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-imperative-actions/ class="pf-c-nav__link pf-m-current">Imperative actions</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-ideas-for-customization/ class=pf-c-nav__link>Ideas for customization</a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class="pf-c-page__main-section pf-m-fill"><div class=pf-u-display-flex><div class="pf-c-content min-height"><div class=sect1><h2 id=mcg-using-kubernetes-cronjob-imperative-actions><a class=anchor href=#mcg-using-kubernetes-cronjob-imperative-actions></a>Using kubernetes cronjobs to apply imperative actions</h2><div class=sectionbody><div class=paragraph><p>There is currently no way within Argo CD to apply an imperative action against a cluster. However, you can declaratively apply changes to a cluster using kubernetes cronjob resources. Customers can use their Ansible playbooks to take action against a cluster if necessary.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class=icon><i class="fa icon-warning" title=Warning></i></td><td class=content><div class=paragraph><p>The authors of the Ansible playbooks and roles must ensure that the playbooks are idempotent because they get applied through cronjobs which are set to run every 10 minutes.</p></div></td></tr></tbody></table></div><div class=paragraph><p>Adding your playbooks to the pattern requires the following:</p></div><div class="olist arabic"><ol class=arabic><li><p>Move your Ansible configurations to the appropriate directory under Ansible in your forked repository.</p></li><li><p>Define your job as a list, for example:</p></li></ol></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml>  <span class=na>imperative</span><span class=pi>:</span>
    <span class=c1># NOTE: We *must* use lists and not hashes. As hashes lose ordering once parsed by helm</span>
    <span class=c1># The default schedule is every 10 minutes: imperative.schedule</span>
    <span class=c1># Total timeout of all jobs is 1h: imperative.activeDeadlineSeconds</span>
    <span class=c1># imagePullPolicy is set to always: imperative.imagePullPolicy</span>
    <span class=c1># For additional overrides that apply to the jobs, please refer to the README located in</span>
    <span class=c1># the top level of this repository.</span>
    <span class=na>jobs</span><span class=pi>:</span>
    <span class=pi>-</span> <span class=na>name</span><span class=pi>:</span> <span class=s>regional-ca</span>
      <span class=c1># Ansible playbook to be run</span>
      <span class=na>playbook</span><span class=pi>:</span> <span class=s>ansible/playbooks/on-hub-get-regional-ca.yml</span>
      <span class=c1># per playbook timeout in seconds</span>
      <span class=na>timeout</span><span class=pi>:</span> <span class=m>234</span>
      <span class=c1># verbosity: &#34;-v&#34;</span></code></pre></div></div><div class=sect2><h3 id=_additional_job_customizations><a class=anchor href=#_additional_job_customizations></a>Additional job customizations</h3><div class=paragraph><p>The pattern includes override parameters to provide further customization. Refer to the list below for the available overrides.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml>  <span class=na>imperative</span><span class=pi>:</span>
    <span class=na>jobs</span><span class=pi>:</span> <span class=pi>[]</span>
    <span class=c1># This image contains Ansible + kubernetes.core by default and is used to run the jobs</span>
    <span class=na>image</span><span class=pi>:</span> <span class=s>registry.redhat.io/ansible-automation-platform-22/ee-supported-rhel8:latest</span>
    <span class=na>namespace</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>imperative&#34;</span>
    <span class=c1># configmap name in the namespace that will contain all helm values</span>
    <span class=na>valuesConfigMap</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>helm-values-configmap&#34;</span>
    <span class=na>cronJobName</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>imperative-cronjob&#34;</span>
    <span class=na>jobName</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>imperative-job&#34;</span>
    <span class=na>imagePullPolicy</span><span class=pi>:</span> <span class=s>Always</span>
    <span class=c1># This is the maximum timeout of all the jobs (1h)</span>
    <span class=na>activeDeadlineSeconds</span><span class=pi>:</span> <span class=m>3600</span>
    <span class=c1># By default we run this every 10minutes</span>
    <span class=na>schedule</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>*/10</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&#34;</span>
    <span class=c1># Schedule used to trigger the vault unsealing (if explicitely enabled)</span>
    <span class=c1># Set to run every 9 minutes in order for load-secrets to succeed within</span>
    <span class=c1># a reasonable amount of time (it waits up to 15 mins)</span>
    <span class=na>insecureUnsealVaultInsideClusterSchedule</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>*/9</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&#34;</span>
    <span class=c1># Increase Ansible verbosity with &#39;-v&#39; or &#39;-vv..&#39;</span>
    <span class=na>verbosity</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>&#34;</span>
    <span class=na>serviceAccountCreate</span><span class=pi>:</span> <span class=kc>true</span>
    <span class=c1># service account to be used to run the cron pods</span>
    <span class=na>serviceAccountName</span><span class=pi>:</span> <span class=s>imperative-sa</span>
    <span class=na>clusterRoleName</span><span class=pi>:</span> <span class=s>imperative-cluster-role</span>
    <span class=na>clusterRoleYaml</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>&#34;</span>
    <span class=na>roleName</span><span class=pi>:</span> <span class=s>imperative-role</span>
    <span class=na>roleYaml</span><span class=pi>:</span> <span class=s2>&#34;</span><span class=s>&#34;</span></code></pre></div></div></div></div></div></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#mcg-using-kubernetes-cronjob-imperative-actions>Using kubernetes cronjobs to apply imperative actions</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#_additional_job_customizations>Additional job customizations</a></li></ul></li></ul></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>