<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Managed cluster sites | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/ class=pf-c-nav__link>Multicloud GitOps</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-getting-started/ class=pf-c-nav__link>Getting started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-managed-cluster/ class="pf-c-nav__link pf-m-current">Managed cluster sites</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-cluster-sizing/ class=pf-c-nav__link>Cluster sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-imperative-actions/ class=pf-c-nav__link>Imperative actions</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops/mcg-ideas-for-customization/ class=pf-c-nav__link>Ideas for customization</a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class="pf-c-page__main-section pf-m-fill"><div class=pf-u-display-flex><div class="pf-c-content min-height"><div class=sect1><h2 id=understanding-acm-requirements-managed-cluster><a class=anchor href=#understanding-acm-requirements-managed-cluster></a>Understanding Red Hat Advanced Cluster Management requirements</h2><div class=sectionbody><div class=paragraph><p>By default, Red Hat Advanced Cluster Management (RHACM) manages the <code>clusterGroup</code> applications that are deployed on all clusters. In the <code>value-hub.yaml</code> file, add a <code>managedClusterCgroup</code> for each cluster or group of clusters that you want to manage as one.</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml>  <span class=na>managedClusterGroups</span><span class=pi>:</span>
  <span class=pi>-</span> <span class=na>name</span><span class=pi>:</span> <span class=s>region-one</span>
    <span class=na>helmOverrides</span><span class=pi>:</span>
    <span class=pi>-</span> <span class=na>name</span><span class=pi>:</span> <span class=s>clusterGroup.isHubCluster</span>
      <span class=na>value</span><span class=pi>:</span> <span class=kc>false</span>
    <span class=na>clusterSelector</span><span class=pi>:</span>
      <span class=na>matchLabels</span><span class=pi>:</span>
        <span class=na>clusterGroup</span><span class=pi>:</span> <span class=s>region-one</span></code></pre></div></div><div class=paragraph><p>The above YAML file segment deploys the <code>clusterGroup</code> applications on managed clusters with the label <code>clusterGroup=region-one</code>. Specific subscriptions and Operators, applications and projects for that <code>clusterGroup</code> are then managed in a <code>value-region-one.yaml</code> file. For example:</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=yaml>  <span class=na>namespaces</span><span class=pi>:</span>
    <span class=pi>-</span> <span class=s>config-demo</span>

  <span class=na>projects</span><span class=pi>:</span>
    <span class=pi>-</span> <span class=s>config-demo</span>

  <span class=na>applications</span><span class=pi>:</span>
    <span class=na>config-demo</span><span class=pi>:</span>
      <span class=na>name</span><span class=pi>:</span> <span class=s>config-demo</span>
      <span class=na>namespace</span><span class=pi>:</span> <span class=s>config-demo</span>
      <span class=na>project</span><span class=pi>:</span> <span class=s>config-demo</span>
      <span class=na>path</span><span class=pi>:</span> <span class=s>charts/all/config-demo</span>

  <span class=c1>#Subscriptions can be added too - multicloud-gitops at present does not require subscriptions on its managed clusters</span>
  <span class=c1>#subscriptions:</span>
<span class=s>.</span>  <span class=c1>#  example-subscription</span>
  <span class=c1>#    name: example-operator</span>
  <span class=c1>#    namespace: example-namespace</span>
  <span class=c1>#    channel: example-channel</span>
  <span class=c1>#    csv: example-operator.v1.0.0</span>

  <span class=na>subscriptions</span><span class=pi>:</span></code></pre></div></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content><div class=paragraph><p>Ensure that you commit the changes and push them to GitHub so that GitOps can fetch your changes and apply them.</p></div></td></tr></tbody></table></div></div></div><div class=sect1><h2 id=deploying-a-managed-cluster-using-rhacm><a class=anchor href=#deploying-a-managed-cluster-using-rhacm></a>Deploying a managed cluster by using Red Hat Advanced Cluster Management</h2><div class=sectionbody><div class=ulist><div class=title>Prerequistes</div><ul><li><p>An OpenShift cluster</p><div class=ulist><ul><li><p>To create an OpenShift cluster, go to the <a href=https://console.redhat.com/>Red Hat Hybrid Cloud console</a>.</p></li><li><p>Select <strong>OpenShift</strong> → <strong>Clusters</strong> → <strong>Create cluster</strong>.</p></li></ul></div></li><li><p>Red Hat Advanced Cluster Management (RHACM) web console to join the managed cluster to the management hub</p><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>After RHACM is installed, a message regarding a <strong>Web console update is available</strong>" might be displayed. Follow the instructions and click the <strong>Refresh web console</strong> link.</p></div></td></tr></tbody></table></div></li></ul></div><div class="olist arabic"><div class=title>Procedure</div><ol class=arabic><li><p>In the left navigation panel of web console, click <strong>local-cluster</strong>. Select <strong>All Clusters</strong>. The RHACM web console is displayed with <strong>Cluster</strong>* on the left navigation panel.</p></li><li><p>On the <strong>Managed clusters</strong> tab, click <strong>Import cluster</strong>.</p></li><li><p>On the <strong>Import an existing cluster</strong> page, enter the cluster name and choose <strong>KUBECONFIG</strong> as the "import mode". Add the tag <code>clusterGroup=region-one</code>. Click <strong>Import</strong>.</p></li></ol></div><div class=paragraph><p>Now that RHACM is no longer deploying the managed cluster applications everywhere, you must indicate that the new cluster has the managed cluster role.</p></div></div></div><div class=sect1><h2 id=deploying-managed-cluster-using-cm-cli-tool><a class=anchor href=#deploying-managed-cluster-using-cm-cli-tool></a>Optional: Deploying a managed cluster by using <code>cm-cli</code> tool</h2><div class=sectionbody><div class=ulist><div class=title>Prerequistes</div><ul><li><p>An OpenShift cluster</p><div class=ulist><ul><li><p>To create an OpenShift cluster, go to the <a href=https://console.redhat.com/>Red Hat Hybrid Cloud console</a>.</p></li><li><p>Select <strong>OpenShift -> Clusters -> Create cluster</strong>.</p></li></ul></div></li><li><p><a href=https://github.com/open-cluster-management/cm-cli/#installation>The <code>cm-cli</code> tool</a></p></li></ul></div><div class="olist arabic"><div class=title>Procedure</div><ol class=arabic><li><p>Obtain the <code>KUBECONFIG</code> file from the managed cluster.</p></li><li><p>Open a shell prompt and login into the management hub cluster by using either of the following methods:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=go>oc login</span></code></pre></div></div><div class=paragraph><p>or</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=gp>export KUBECONFIG=~/&lt;path_to_kubeconfig&gt;</span></code></pre></div></div></li><li><p>Run the following command:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=gp>cm attach cluster --cluster &lt;cluster-name&gt;</span><span class=w> </span><span class=nt>--cluster-kubeconfig</span> &lt;path-to-path_to_kubeconfig&gt;</code></pre></div></div></li></ol></div><div class="ulist _next-steps"><div class=title>Next steps</div><ul><li><p><a href=#designate-cluster-as-a-managed-cluster-site>Designate the new cluster as a managed cluster site</a></p></li></ul></div></div></div><div class=sect1><h2 id=deploying-managed-cluster-using-clusteradm-tool><a class=anchor href=#deploying-managed-cluster-using-clusteradm-tool></a>Optional: Deploying a managed cluster by using the <code>clusteradm</code> tool</h2><div class=sectionbody><div class=ulist><div class=title>Prerequistes</div><ul><li><p>An OpenShift cluster</p><div class=ulist><ul><li><p>To create an OpenShift cluster, go to the <a href=https://console.redhat.com/>Red Hat Hybrid Cloud console</a>.</p></li><li><p>Select <strong>OpenShift</strong> → <strong>Clusters</strong> → <strong>Create cluster</strong>.</p></li></ul></div></li><li><p><a href=https://github.com/open-cluster-management-io/clusteradm#install-the-clusteradm-command-line>The <code>clusteradm</code> tool</a></p></li></ul></div><div class="olist arabic"><div class=title>Procedure</div><ol class=arabic><li><p>To deploy an edge cluster, you must to get the token from the management hub cluster. Run the following command on the existing management hub or datacenter cluster:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=go>clusteradm get token</span></code></pre></div></div><div class=paragraph><p>The command generates a token and shows you the command to use on the managed cluster.</p></div></li><li><p>Login to the managed cluster with either of the following methods:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=go>oc login</span></code></pre></div></div><div class=paragraph><p>or</p></div><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=gp>export KUBECONFIG=~/&lt;path_to_kubeconfig&gt;</span></code></pre></div></div></li><li><p>To request that the managed join the hub cluster, run the following command:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=gp>clusteradm join --hub-token &lt;token_from_clusteradm_get_token_command&gt;</span><span class=w> </span>&lt;managed_cluster_name&gt;</code></pre></div></div></li><li><p>Accept the <code>join</code> request on the hub cluster:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=gp>clusteradm accept --clusters &lt;managed_cluster_name&gt;</span></code></pre></div></div></li></ol></div><div class="ulist _next-steps"><div class=title>Next steps</div><ul><li><p><a href=#designate-cluster-as-a-managed-cluster-site>Designate the new cluster as a managed cluster site</a></p></li></ul></div><div class=sect2><h3 id=designate-cluster-as-a-managed-cluster-site><a class=anchor href=#designate-cluster-as-a-managed-cluster-site></a>Designate the new cluster as a managed cluster site</h3><div class=paragraph><p>If you use the command line tools such as <code>clusteradm</code> or <code>cm-cli</code>, you must explicitly indicate that the imported cluster is part of a specific <code>clusterGroup</code>. Some examples of <code>clusterGroup</code> are <code>factory</code>, <code>devel</code>, or <code>prod</code>.</p></div><div class=paragraph><p>To tag the cluster as <code>clusterGroup=&lt;managed-cluster-group></code>, complete the following steps.</p></div><div class="olist arabic"><div class=title>Procedure</div><ol class=arabic><li><p>To find the new cluster, run the following command:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=go>oc get managedcluster.cluster.open-cluster-management.io</span></code></pre></div></div></li><li><p>To apply the label, run the following command:</p><div class=listingblock><div class=content><pre class="rouge highlight"><code data-lang=terminal><span class=go>oc label managedcluster.cluster.open-cluster-management.io/YOURCLUSTER site=managed-cluster</span></code></pre></div></div></li></ol></div></div></div></div><div class=sect1><h2 id=_verification><a class=anchor href=#_verification></a>Verification</h2><div class=sectionbody><div class=paragraph><p>Go to your managed cluster (edge) OpenShift console and check for the <code>open-cluster-management-agent</code> pod being launched. It might take a while for the RHACM agent and <code>agent-addons</code> to launch. After that, the OpenShift GitOps Operator is installed. On successful installation, launch the OpenShift GitOps (ArgoCD) console from the top right of the OpenShift console.</p></div></div></div></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#understanding-acm-requirements-managed-cluster>Understanding Red Hat Advanced Cluster Management requirements</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#deploying-a-managed-cluster-using-rhacm>Deploying a managed cluster by using Red Hat Advanced Cluster Management</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#deploying-managed-cluster-using-cm-cli-tool>Optional: Deploying a managed cluster by using <code>cm-cli</code> tool</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#deploying-managed-cluster-using-clusteradm-tool>Optional: Deploying a managed cluster by using the <code>clusteradm</code> tool</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#designate-cluster-as-a-managed-cluster-site>Designate the new cluster as a managed cluster site</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#_verification>Verification</a></li></ul></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>