<!doctype html><html><head><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://hybrid-cloud-patterns.io/sass/patternfly-addons.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/solid.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/fontawesome.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v6.3.0/css/brands.css><title>Multicloud GitOps with Portworx Enterprise | Hybrid Cloud Patterns</title></head><body><div class=pf-c-page><header class=pf-c-page__header><div class=pf-c-page__header-brand><a href=/ class=pf-c-page__header-brand-link><img src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a></div><div class=pf-c-page__header-tools><nav class="pf-c-nav pf-m-horizontal" role=navigation><ul class=pf-c-nav__list><li class="pf-c-nav__item pf-m-current"><a class=pf-c-nav__link href=/patterns/ title=Patterns>Patterns</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/learn/ title=Learn>Learn</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/contribute/ title=Contribute>Contribute</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/blog/ title=Blog>Blog</a></li><li class=pf-c-nav__item><a class=pf-c-nav__link href=/ci/ title=Status>Status</a></li></ul></nav></div></header><div class=pf-c-page__sidebar><div class=pf-c-page__sidebar-body><div class="pf-l-flex filter-title-div"><span class="pf-c-title pf-m-md filter-title pf-l-flex__item pf-m-grow">Menu</span></div><div class="pf-c-select pf-m-expanded"><div class=pf-c-select__menu><div class="pf-c-nav pf-m-light"><ul class=pf-c-nav__list><li class=pf-c-nav__item><a href=/patterns/ class=pf-c-nav__link><span class="pf-c-icon pf-m-md pf-m-inline"><span class=pf-c-icon__content><i class="fas fa-angle-left" aria-hidden=true></i></span></span>
<span style=padding-left:10px>Back to Patterns</span></a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops-portworx/ class="pf-c-nav__link pf-m-current">Multicloud GitOps with Portworx Enterprise</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops-portworx/getting-started/ class=pf-c-nav__link>Getting Started</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops-portworx/managed-cluster/ class=pf-c-nav__link>Managed cluster sites</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops-portworx/cluster-sizing/ class=pf-c-nav__link>Cluster Sizing</a></li><li class="pf-c-nav__item pf-m-expanded"><a href=https://hybrid-cloud-patterns.io/patterns/multicloud-gitops-portworx/ideas-for-customization/ class=pf-c-nav__link>Ideas for Customization</a></li></ul></div></div></div></div></div><main class=pf-c-page__main tabindex=0 data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=50><section class=pf-c-page__main-section><div class=pf-u-display-flex><div class="pf-c-content min-height"><div class=pattern-label><span class="pf-c-label pf-m-blue"><span class=pf-c-label__content><span class=pf-c-label__icon><i class="fas fa-fw fa-users" aria-hidden=true></i></span>
Community</span></span></div><div class=pattern_logo><img src=/images/logos/multicloud-gitops-Portworx.png class=pattern_logo alt=Points></div><script type=text/javascript src=/js/dashboard.js></script><div class=results><p id=ci-dataset></p><script>obtainBadges({target:"ci-dataset",filter_field:"pattern",filter_value:"mcgitopspxe"})</script></div><h1 id=multicloud-gitops-with-portworx-enterprise>Multicloud GitOps with Portworx Enterprise</h1><p><a href=getting-started class="btn btn-green fs-5 mb-4 mb-md-0 mr-2">Install</a>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class="btn fs-5 mb-4 mb-md-0 mr-2">Help & Feedback</a>
<a href=https://github.com/portworx/rh-multicloud-gitops-pxe/issues class="btn btn-red fs-5 mb-4 mb-md-0 mr-2">Report Bugs</a></p><p><em>Some details will differ based on the requirements of a specific implementation but all validated patterns, based on a portfolio architecture, generalize one or more successful deployments of a use case.</em></p><p><strong>Use case:</strong></p><ul><li>Use a GitOps approach to manage hybrid and multi-cloud deployments across both public and private clouds.</li><li>Enable cross-cluster governance and application lifecycle management.</li><li>Securely manage secrets across the deployment.</li><li>Deploy and configure Portworx Enterprise persistent storage for stateful applications.</li></ul><p><strong>Background:</strong>
Organizations are aiming to develop, deploy, and operate applications on an open hybrid cloud in a stable, simple, and secure way. This hybrid strategy includes multi-cloud deployments where workloads might be running on multiple clusters and on multiple clouds—private or public. It include Portworx Enterprise for persistent storage and Kubernetes data services required for stateful applications.</p><p>This strategy requires an infrastructure-as-code approach: GitOps. GitOps uses Git repositories as a single source of truth to deliver infrastructure-as-code. Submitted code checks the continuous integration (CI) process, while the continuous delivery (CD) process checks and applies requirements for things like security, infrastructure-as-code, or any other boundaries set for the application framework. All changes to code are tracked, making updates easy while also providing version control should a rollback be needed.</p><h2 id=solution-overview>Solution overview</h2><p>This architecture covers hybrid and multi-cloud management with GitOps as shown in Figure 1. At a high level this requires a management hub, for DevOps and GitOps, and infrastructure that extends to one or more managed clusters running on private or public clouds. The automated infrastructure-as-code approach can manage the versioning of components and deploy according to the infrastructure-as-code configuration.</p><p><strong>Why Hybrid Multicloud management with GitOps ?</strong></p><ul><li>Unify management across cloud environments.</li><li>Dynamic infrastructure security.</li><li>Infrastructural continuous delivery best practices.</li></ul><p><a href=/images/multicloud-gitops/hybrid-multicloud-management-gitops-hl-arch.png><img src=/images/multicloud-gitops-Portworx/hybrid-multicloud-management-gitops-hl-arch.png alt="Multi-Cloud Architecture"></a></p><p><em>Figure 1 shows a high-level overview of the solution including the business drivers, management hub, and the clusters under management.</em></p><h2 id=logical-diagram>Logical diagram</h2><p><a href=/images/multicloud-gitops-Portworx/logical-diagram.png><img src=/images/multicloud-gitops-Portworx/logical-diagram.png alt="Logical Architecture"></a></p><p><em>Figure 2. Logical diagram of hybrid multi-cloud management with GitOps.</em></p><p>As you can see in Figure 2, logically this solution can be viewed as being composed of an automation component, unified management (including secrets management), and the cluster(s) under management—all running on top of a user-chosen mixture of on-prem data center(s) and public cloud(s).</p><h2 id=the-technology>The technology</h2><p>The following technology was chosen for this solution.</p><p><a href=https://www.redhat.com/en/technologies/cloud-computing/openshift/try-it><em>Red Hat OpenShift Platform</em></a> is an enterprise-ready Kubernetes container platform built for an open hybrid cloud strategy. It provides a consistent application platform to manage hybrid cloud, public cloud, and edge deployments. It delivers a complete application platform for both traditional and cloud-native applications, allowing them to run anywhere. OpenShift has a pre-configured, pre-installed, and self-updating monitoring stack that provides monitoring for core platform components. It also enables the use of external secret management systems (like HashiCorp Vault in this case) to securely add secrets into the OpenShift platform.</p><p><a href=https://www.redhat.com/en/technologies/cloud-computing/openshift/try-it><em>Red Hat OpenShift GitOps</em></a> is a declarative application continuous delivery tool for Kubernetes based on the ArgoCD project. Application definitions, configurations, and environments are declarative and version controlled in Git. It can automatically push the desired application state into a cluster, quickly find out if the application state is in sync with the desired state, and manage applications in multi-cluster environments.</p><p><a href=https://www.redhat.com/en/technologies/management/advanced-cluster-management><em>Red Hat Advanced Cluster Management for Kubernetes</em></a> controls clusters and applications from a single console, with built-in security policies. Extends the value of Red Hat OpenShift by deploying apps, managing multiple clusters, and enforcing policies across multiple clusters at scale.</p><p><a href=https://www.redhat.com/en/technologies/management/ansible><em>Red Hat Ansible Automation Platform</em></a> provides an enterprise framework for building and operating IT automation at scale across hybrid clouds including edge deployments. It enables users across an organization to create, share, and manage automation—from development and operations to security and network teams.</p><p><a href=https://portworx.com/redhat><em>Portworx Enterprise</em></a> provides persistent storage and Kubernetes data services to Red Hat OpenShift. Persistence is necessary for stateful applications in Kubernetes environments. Portworx also provides business continuity with <a href=https://www.redhat.com/en/resources/portworx-backup-partner-solution-brief>Portworx Backup</a> and <a href=https://www.redhat.com/en/resources/portworx-disaster-recovery-brief>Portworx DR</a> products that will be incorporated in a future GitOps pattern.</p><p><strong>Hashicorp Vault</strong> provides a secure centralized store for dynamic infrastructure and applications across clusters, including over low-trust networks between clouds and data centers.</p><p>This solution also uses a variety of <em>observability tools</em> including the Prometheus monitoring and Grafana dashboard that are integrated with OpenShift as well as components of the Observatorium meta-project which includes Thanos and the Loki API.</p><h2 id=architectures>Architectures</h2><p>Figure 3 provides a schematic diagram overview of the complete solution including both components and data flows.</p><p>Subsequent schematic diagrams go into more detail on:</p><ul><li>Bootstrapping the management hub (Figure 4)</li><li>Hybrid multi-cloud GitOps (Figure 5)</li><li>Dynamic security management (Figure 6)</li><li>Observability in hybrid multi-cloud environments (Figure 7)</li></ul><p><a href=/images/multicloud-gitops-Portworx/schema-gitops.png><img src=/images/multicloud-gitops-Portworx/schema-gitops.png alt="Physical Architecture"></a></p><p><em>Figure 3. Overview schematic diagram of the complete solution.</em></p><h3 id=bootstrapping-the-management-hub>Bootstrapping the management hub</h3><p><a href=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-install.png><img src=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-install.png alt="Schematic diagram of bootstrapping the management hub"></a></p><p><em>Figure 4. Schematic diagram of bootstrapping the management hub.</em></p><p>As detailed below, Figure 4 provides a schematic diagram showing the setup of the management hub using Ansible playbooks.</p><ul><li>Set up the Red Hat OpenShift Platform that hosts the Management Hub. The OpenShift installation program provides flexible ways to install OpenShift. An Ansible playbook kicks off the installation with necessary configurations.</li><li>Ansible playbooks are again used to deploy and configure Red Hat Advanced Cluster Management for Kubernetes and, later, other supporting components (such as external secrets management) on top of the provisioned OpenShift cluster.</li><li>Another Ansible playbook installs HashiCorp Vault, a Red Hat partner product chosen for this solution that can be used to manage secrets for OpenShift clusters.</li><li>An Ansible playbook is used again to configure and trigger the Openshift GitOps operator on the hub cluster. This deploys the Openshift GitOps instance to enable continuous delivery.</li></ul><h3 id=hybrid-multicloud-gitops>Hybrid multicloud GitOps</h3><p><a href=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-security.png><img src=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-security.png alt="Schematic diagram of hybrid multi-cloud management with GitOps"></a></p><p><em>Figure 5. Schematic diagram of hybrid multi-cloud management with GitOps.</em></p><p>As detailed below, Figure 5 provides a schematic diagram showing remaining activities associated with setting up the management hub and clusters using Red Hat Advanced Cluster Management.</p><ul><li>Manifest and configuration are set as code template in the form of “Kustomization” yaml. It describes the end desire state of how the managed cluster is going to be like. When done, it is pushed into the source control management repository with a version assigned to each update.</li><li>OpenShift GitOps watches the repository and detects changes in the repository.</li><li>OpenShift GitOps creates/updates the manifest by creating Kubernetes objects on top of Red Hat Advanced Cluster Management.</li><li>Red Hat Advanced Cluster Management provision/update/delete managed clusters and configuration according to the manifest. In the manifest, you can configure what cloud provider the cluster will be on, the name of the cluster, infra node details and worker node. Governance policy can also be applied as well as provision an agent in the cluster as the bridge between the control center and the managed cluster.</li><li>OpenShift GitOps will continuously watch between the code repository and status of the clusters reported back to Red Hat Advanced Cluster Management. Any configuration drift or in case of any failure, it will automatically try to remediate by applying the manifest (Or showing alerts for manual intervention).</li></ul><h3 id=dynamic-security-management>Dynamic security management</h3><p><a href=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-security.png><img src=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-security.png alt="Schematic showing the setup and use of external secrets management"></a></p><p><em>Figure 6. Schematic showing the setup and use of external secrets management.</em></p><p>As detailed below, Figure 6 provides a schematic diagram showing how secrets are handled in this solution.</p><p>During setup, the token to securely access HashiCorp Vault is stored in Ansible Vault. It is encrypted to protect sensitive content.</p><p>Red Hat Advanced Cluster Management for Kubernetes allows us to have centralized control over the managed clusters. It acquires the token from Ansible Vault during install and distributes it among the clusters.</p><p>To allow the cluster access to the external vault, we need to set up the external secret management (with Helm in this study). OpenShift Gitops is used to deploy the external secret object to a managed cluster.</p><p>External secret management fetches secrets from HashiCorp Vault using the token we created in step 2 and constantly watches for updates.
Secrets are created in each namespace, where applications can use them.</p><p>Secrets are created in each namespace, where applications can use them.</p><h3 id=observability-in-hybrid-multicloud-environment>Observability in hybrid multicloud environment</h3><p><a href=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-monitoring.png><img src=/images/multicloud-gitops-Portworx/spi-multi-cloud-gitops-sd-monitoring.png alt="Schematic showing the use of Observatorium and other tools to add observability to the solution"></a></p><p><em>Figure 7. Schematic showing the use of Observatorium and other tools to add observability to the solution.</em></p><p>As detailed below, Figure 7 provides a schematic diagram of integrating a variety of open source tools to implement observability.</p><ul><li>The Grafana dashboard in Hub cluster makes queries. The central Querier component in Observatorium processes the Prom. QL queries and aggregates the results.</li><li>Prometheus scrapes metrics in the local cluster; a Thanos sidecar pushes metrics to Observatorium to persist in storage.</li><li>A Thanos sidecar acts as a proxy that serves Prometheus’s local data over Thanos’s gRPC API from the Querier.</li><li>Promtail is used to collect logs and push to Observatorium’s Loki API.</li><li>In Observatorium, the Loki distributor sends logs in batches to ingester, where they will be persisted. A couple of things to beware of: both ingester and querier require large memory consumption, will need more replicas.</li><li>The Grafana dashboard in Hub cluster display logs via requesting: real-time display (tail) with WebSocket or a time-series-based query with HTTP.</li></ul><p>For logical, physical and dataflow diagrams, please see excellent work done by the <a href=https://www.redhat.com/architect/portfolio/detail/8>Red Hat Portfolio Architecture team</a></p><h2 id=demo-scenario>Demo Scenario</h2><h2 id=download-diagrams>Download diagrams</h2><p>View and download all of the diagrams above in our open source tooling site.</p><p><a href=https://www.redhat.com/architect/portfolio/tool/index.html?#gitlab.com/osspa/portfolio-architecture-examples/-/raw/main/diagrams/spi-multi-cloud-gitops.drawio>[Open Diagrams]</a></p><h2 id=what-next>What Next</h2><ul><li><a href=getting-started>Deploy the management hub</a> using Helm</li><li>Add a managed cluster to <a href=managed-cluster>deploy the managed cluster piece using ACM</a></li></ul></div><aside class="pf-c-jump-links pf-m-vertical sticky pf-m-expandable pf-m-non-expandable-on-2xl" aria-label="Table of contents"><div class=pf-c-jump-links__header><div class=pf-c-jump-links__label><h1>Table of Contents</h1></div></div><nav id=TableOfContents><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#multicloud-gitops-with-portworx-enterprise>Multicloud GitOps with Portworx Enterprise</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#solution-overview>Solution overview</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#logical-diagram>Logical diagram</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#the-technology>The technology</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#architectures>Architectures</a><ul class=pf-c-jump-links__list><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#bootstrapping-the-management-hub>Bootstrapping the management hub</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#hybrid-multicloud-gitops>Hybrid multicloud GitOps</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#dynamic-security-management>Dynamic security management</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#observability-in-hybrid-multicloud-environment>Observability in hybrid multicloud environment</a></li></ul></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#demo-scenario>Demo Scenario</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#download-diagrams>Download diagrams</a></li><li class=pf-c-jump-links__item><a class=pf-c-jump-links__link href=#what-next>What Next</a></li></ul></li></ul></nav></aside></div></section><section id=prefooter class="pf-c-page__main-section footer-dark"><div class="pf-l-grid prefooter-menu-grid"><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-6-col-on-md pf-m-offset-1-col-on-md pf-u-mb-lg pf-u-mb-0-on-sm"><div class="pf-l-grid pf-u-py-xl"><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">QUICKLINKS</p><nav aria-label="Quick Links"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fa-brands fa-github"></i>
<a class=footer-link aria-label="GitHub repository" href=https://github.com/hybrid-cloud-patterns>GitHub repository</a></li><li><i class="prefooter-icon fas fa-check-circle"></i>
<a class=footer-link aria-label="Available patterns" href=/patterns>Available patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-sm pf-u-ml-md pf-u-ml-0-on-md pf-u-mb-xl pf-u-mb-0-on-md"><p class="pf-c-title footer-menu-title">CONTRIBUTE</p><nav aria-label=Contribute><ul class="pf-c-list pf-m-plain ws-org-pfsite-footer-menu-list"><li><i class="prefooter-icon fas fa-pen"></i>
<a class=footer-link aria-label="Documentation contributor guidelines" href=/contribute/contribute-to-docs/>Documentation</a></li><li><i class="prefooter-icon fas fa-code"></i>
<a class=footer-link aria-label="How to create a new pattern" href=/contribute/creating-a-pattern/>Patterns</a></li></ul></nav></div><div class="pf-l-grid__item pf-m-6-col-on-sm pf-m-4-col-on-md pf-u-mt-lg pf-u-mt-0-on-md pf-u-ml-md pf-u-ml-0-on-md"><p class="pf-c-title footer-menu-title">STAY IN TOUCH</p><nav aria-label="Stay in touch"><ul class="pf-c-list pf-m-plain"><li><i class="prefooter-icon fas fa-envelope"></i>
<a href=https://groups.google.com/g/hybrid-cloud-patterns class=footer-link target=top aria-label="Join the Validated Patterns mailing list">Mailing list</a></li></ul></nav></div></div></div><div class="pf-l-grid__item pf-m-12-col-on-sm pf-m-4-col-on-md"><div class="pf-l-grid pf-u-pt-xl"><div class="pf-l-grid__item pf-u-px-xl"><a class="pf-c-page__header-brand-link pf-c-brand pf-u-pb-md" href=/><img class=pf-c-brand src=/images/hybrid_cloud_patterns.png alt="Hybrid Cloud Patterns"></a><p class=footer-link>Hybrid Cloud Patterns are an evolution of how you deploy applications in a hybrid cloud. With a pattern, you can automatically deploy a full application stack through a GitOps-based framework. With this framework, you can create business-centric solutions while maintaining a level of Continuous Integration (CI) over your application.</p></div></div></div></div></section><footer id=footer class="footer-dark pf-m-no-fill pf-l-flex footer-center"><div class=pf-l-flex__item><a href=//www.redhat.com target=top aria-label="Visit Red Hat.com"><img src=/images/RHlogo.svg alt="Red Hat logo" width=145px height=613px></a><span class=site-copyright>Copyright &copy; 2023 Red Hat, Inc.</span></div><script src=/js/bootstrap.bundle.js></script></footer></main></div></body></html>